patterns:
  - name: "Post-password-change sign-in failures"
    hints:
      - "changed password"
      - "MFA loop"
      - "stuck signing in"
    steps:
      - "Sign out everywhere and clear cached credentials."
      - "Force token refresh with InPrivate or a client reset."
      - "Confirm MFA methods plus license or role scope."
    ps_fast:
      scope:
        modules:
          - "Microsoft.Graph.Authentication"
        auth: "Connect-MgGraph -Scopes 'User.ReadWrite.All','Directory.Read.All'"
        perms: "Helpdesk or higher with rights to read and reset authentication methods"
      steps:
        - "# Inspect recent sign-in errors."
        - "Get-MgAuditLogSignIn -Filter \"UserId eq '{UPN}'\" -Top 5"
        - "# Refresh or clear stale sessions if policy permits."
      rollback: "If session revocation causes regression, reinstate the previous MFA method or session scope per policy."
      automation_hook: "Wrap sign-in signal triage into a function that pulls last errors and suggests next steps."

  - name: "Teams/Outlook profile corruption"
    hints:
      - "search broken"
      - "won't start"
      - "calendar desync"
    steps:
      - "Reset Teams cache or build a new Outlook profile."
      - "Confirm Web Account Manager or WebAuth state."
      - "Check Microsoft 365 service health."
    ps_fast:
      scope:
        modules:
          - "ExchangeOnlineManagement"
        auth: "Connect-ExchangeOnline -UserPrincipalName {adminUPN}"
        perms: "Mailbox support role"
      steps:
        - "Get-EXOMailbox -Identity {UPN} | Select-Object RecipientTypeDetails, ExternalDirectoryObjectId"
        - "Get-EXOMailboxStatistics -Identity {UPN} | Select-Object ItemCount, TotalItemSize, LastLogonTime"
        - "# Optional: Set-CASMailbox {UPN} -MAPIEnabled:$true (if policy drift)."
      rollback: "Reapply previous CAS mailbox settings or revert cache reset instructions that were issued."
      automation_hook: "Mailbox quick health probe that gates whether a local profile reset is warranted."

  - name: "VPN/SSID pathing"
    hints:
      - "works on guest wifi"
      - "split tunnel"
      - "DNS suffix"
    steps:
      - "Test on an alternate SSID, guest network, or with VPN disabled."
      - "Check split-tunnel configuration and DNS resolution."
      - "Confirm captive portal status."
    ps_fast:
      scope:
        modules: []
        auth: "Local admin shell"
        perms: "Device local admin"
      steps:
        - "Resolve-DnsName target.svc.com"
        - "Test-NetConnection target.svc.com -Port 443"
        - "Get-NetIPConfiguration | Select InterfaceAlias, DNSServer"
      rollback: "Undo temporary network changes and restore the user's original adapter or VPN state."
      automation_hook: "Network sanity check function that runs DNS, port, and route triage with a single call."
